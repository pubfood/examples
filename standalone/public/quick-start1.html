<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width">
    <title>Pubfood Quick Start 1</title>
    <style>
      body { font-family:'Helvetica Neue', Helvetica, Arial, sans-serif; }
      .question { width: 55%; word-break: normal; }
      .step { width: 100%; float: left; }
      .step-text { width: 450px; word-break: normal; float: left; overflow: hidden; }
      .code-sample { width: 600px; margin-left: 2%; float: left; overflow: hidden; }
      pre { overflow-x: scroll; }
      .lines-ref { font-family: monospace; }
      .code-ref { font-family: monospace; }
    </style>
  </head>
  <body>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autorun=false&amp;skin=sons-of-obsidian"></script>
    <script>
      var insertStepScript = function(name, content) {
        var el = document.getElementById(name);
        if (el) {
          var js = document.createElement('script');
          js.innerHTML = content;
          el.parentNode.insertBefore(js, el);
        }
      };

      var insertStepDoc = function(name, content) {
        var el = document.getElementById(name + '-code');
        if (el) {
          el.innerHTML = content;
        }
      };

      var stepsRequested = 0;
      var stepsReturned = 0;
      var getStep = function(name, doScript) {
        stepsRequested += 1;
        var insertCode = doScript || true;
        var xhr = new XMLHttpRequest();
        xhr.onload = function(e) {
          if (this.status === 200) {
            var blob = new Blob([this.response], {type: 'text/javascript'});
            var reader = new FileReader();
            reader.addEventListener('loadend', function() {
              if (insertCode) {
                insertStepScript(name, reader.result);
              }
              insertStepDoc(name, reader.result);
              stepsReturned += 1;
              if (stepsRequested === stepsReturned) {
                PR.prettyPrint();
              }
            });
            reader.readAsText(blob);
          }
        };
        xhr.open('GET', '/quick-start1-' + name + '.js', true);
        xhr.responseType = 'blob';
        xhr.send();
      };

      // global for the auction provider
      window.auctionProviderOne = window.auctionProviderOne || {};
      auctionProviderOne.cmd = auctionProviderOne.cmd || [];

      // globals for all bid providers
      window.bidProviderOne = window.bidProviderOne || {};
      bidProviderOne.cmd = bidProviderOne.cmd || [];
    </script>

    <script src="/pubfood.min.js"></script>

    <h3>Getting started with the Pubfood framework</h3>
    <div id="steps">
      <div class="step">
        <h4><em>The steps</em></h4>
        <div class="step-text">
          <ol>
            <li>
              <b>Include the pubfood JavaScript library in your code.</b>
            </li>
            <li>
              <b><span class="code-ref">food.addSlot(...);</span></b>
              <p>Define slots and which partner may bid for them.</p>
            </li>
            <li>
              <b><span class="code-ref">food.addBidProvider(...);</span></b>
              <p>Define or copy your bidding partner JavaScript code.</p>
              <ol>
                <li>on each bid, call the <b><span class="code-ref">pushBid({});</span></b> callback</li>
                <li>when bidding finished, call the <b><span class="code-ref">done();</span></b> callback</li>
              </ol>
              <br>
            </li>
            <li>
              <b><span class="code-ref">food.setAuctionProvider(...);</span></b>
              <p>Define or copy your ad server JavaScript code to send bids to auction.</p>
            </li>
            <li>
              <b><span class="code-ref">food.observe('AUCTION_POST_RUN', ...);</span></b>
              <p>Define where to display your ad.</p>
            </li>
            <li>
              <b><span class="code-ref">food.timeout(...);</span></b><br>
              <b><span class="code-ref">food.start();</span></b>
              <p>Set a bidder timeout and start the pubfood auction.</p>
            </li>
          </ol>
        </div>
        <div id="theAd" class="code-sample">
            <b><em>How did this ad get here?</em></b>
            <pre id="div-rail"></pre>
        </div>
      </div>
      <div class="step">
        <h4>Include the pubfood library in your site code</h4>
        <div class="step-text">To execute the following steps in your own code, you will need to include the pubfood JavaScript library.</div>
        <div class="code-sample">
          <b><a href="https://github.com/pubfood/pubfood/tree/master/dist">https://github.com/pubfood/pubfood/tree/master/dist</a></b>
          <pre id="step0-code" class="prettyprint linenums"></pre>
        </div>
      </div>
      <div class="step">
        <h4>Define slots</h4>
        <div class="step-text">You will tell Pubfood which of your ad server slots are available for bidding and which partners may bid for therm.</div>
        <div class="code-sample">
          <pre id="step1-code" class="prettyprint linenums"></pre>
        </div>
      </div>
      <div class="step">
        <h4>Define bidding partner</h4>
        <div class="step-text">
          Pubfood does not need to know much about how your bid provider works. What it does need to know is:
          <ul>
            <li><span class="lines-ref">line 2</span> - the bidder name</li>
            <li><span class="lines-ref">line 3</span> - the bid provider JavaScript library to load</li>
            <li><span class="lines-ref">line 4</span> - the function to initialize bids</li>
            <li><span class="lines-ref">line 15</span> - submit a bid with the <span class="code-ref">pushBid({});</span> callback</li>
            <li><span class="lines-ref">line 24</span> - notify pubfood with the <span class="code-ref">done();</span> callback</li>
            <li><span class="lines-ref">line 27</span> - the function to refresh bids</li>
          </ul>
        </div>
        <div class="code-sample">
          <pre id="step2-code" class="prettyprint linenums"></pre>
        </div>
      </div>
      <div class="step">
        <h4>Define your ad server</h4>
        <div class="step-text">
          Set your auction provider that will receive bid targeting and send the targeting to auction in your ad server.
          <ul>
            <li><span class="lines-ref">line 2</span> - the auction provider name</li>
            <li><span class="lines-ref">line 3</span> - the auction provider JavaScript library to load</li>
            <li><span class="lines-ref">line 4</span> - the function to initialize the auction</li>
            <li><span class="lines-ref">line 29</span> - notify pubfood with the <span class="code-ref">done();</span> callback</li>
            <li><span class="lines-ref">line 31</span> - the function to refresh with a new auction</li>
          </ul>
        </div>
        <div class="code-sample">
          <pre id="step3-code" class="prettyprint lang-js linenums"></pre>
        </div>
      </div>
      <div class="step">
        <h4>Define when to display ads</h4>
        <div class="step-text">
          When pubfood has completed the auction orchestration, it will raise an event to indicate ads are ready to display.
          <ul>
            <li><span class="lines-ref">line 1</span> - observe the auction provider</li>
            <li><span class="lines-ref">line 3</span> - the auction provider will display the ad</li>
          </ul>
        </div>
        <div class="code-sample">
          <pre id="step4-code" class="prettyprint lang-js linenums"></pre>
        </div>
      </div>
      <div class="step">
        <h4>Start the pubfood auction</h4>
        <div class="step-text">
          Starting a pubfood auction will initiate and orchestrate the steps defined above.
          <ul>
            <li><span class="lines-ref">line 1</span> - bidders need to respond withing this time</li>
            <li><span class="lines-ref">line 2</span> - we can observe all events for debugging</li>
            <li><span class="lines-ref">line 5</span> - finally, start the auction</li>
          </ul>
        </div>
        <div class="code-sample">
          <pre id="step5-code" class="prettyprint lang-js linenums"></pre>
        </div>
      </div>
    </div>
    <p>
      <span style="font-size: larger; font-weight: bold">Very good</span>
      You read through the steps. <a href="#theAd">This is the sample ad rendered by the steps.</a>
    </p>
    <div>
      <div id="step"></div>
      <div id="step1"></div>
      <div id="step2"></div>
      <div id="step3"></div>
      <div id="step4"></div>
      <div id="step5"></div>
    </div>
    <script>
      getStep('step0', false);
      getStep('step1');
      getStep('step2');
      getStep('step3');
      getStep('step4');
      getStep('step5');
    </script>
  </body>
</html>
